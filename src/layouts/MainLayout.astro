---
import { currentGameId } from '../stores/GameStore';
import type { GameType } from '../types/Game';
import Header from '../components/core/header/Header.astro';
import ContentLayout from '../components/core/layout/ContentLayout.astro';
import BreakPointDebugger from '../components/debug/BreakPointDebugger.astro';

interface Props {
  title?: string;
  description?: string;
  ogImage?: string;
}

// Process game parameter and props
const { game } = Astro.params;
if (game) {
  currentGameId.set(game as GameType);
}

// Constants
const HEADER_HEIGHT = 'h-14';
const DEFAULT_TITLE = 'J9MH';
const DEFAULT_DESCRIPTION = 'lance guides for monster hunter games';

const {
  title = DEFAULT_TITLE,
  description = DEFAULT_DESCRIPTION,
  ogImage = '/og-image.png',
} = Astro.props;
---

<!doctype html>
<html lang="en" class="h-full">
  <head>
    <!-- Meta tags -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/j9mh.ico" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />

    <!-- Open Graph / Social Media -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={ogImage} />

    <!-- Font preload - using Google Fonts as a reliable alternative -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;600&display=swap"
      rel="stylesheet"
    />

    <!-- PWA tags -->
    <meta name="theme-color" content="#000000" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />

    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
  </head>
  <body class="min-h-full font-mono m-0 bg-background text-text flex flex-col">
    <!-- Fixed header -->
    <div class="fixed top-0 left-0 right-0 z-50 bg-background">
      <Header height={HEADER_HEIGHT} />
    </div>

    <!-- Header spacer -->
    <div class:list={[HEADER_HEIGHT]} aria-hidden="true"></div>

    <!-- Main content with side navigation -->
    <main id="main" class="flex-1">
      <ContentLayout>
        <slot />
      </ContentLayout>
    </main>

    <!-- Skip to main content link for accessibility -->
    <a
      href="#main"
      class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-primary text-white p-2 rounded"
    >
      Skip to main content
    </a>

    <BreakPointDebugger />
  </body>
</html>

<style>
  /* Fallback font stack */
  body {
    font-family: 'Roboto Mono', 'Courier New', Courier, monospace;
  }
</style>
