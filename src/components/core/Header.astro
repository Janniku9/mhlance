---
import { Games } from '../../data/games';
import { getGameFromPath } from '../../utils/game';

const currentPath = Astro.url.pathname;
const selectedGame = getGameFromPath(currentPath);

const { height } = Astro.props;
---

<header class=`shadow-lg bg-background-darker ${height}`>
  <div class="flex items-center justify-between h-full p-2 px-2">
    <a href="/" class="text-2xl font-bold">J9MH</a>

    <select
      id="gameSelect"
      class="rounded-lg border border-text bg-background text-primary-lighter h-full"
    >
      <option value="">select game</option>
      {
        Games.map((game) => (
          <option value={game.id} selected={selectedGame?.id === game.id}>
            {game.name}
          </option>
        ))
      }
    </select>
  </div>
</header>

<script>
  import { currentGameId } from '../../stores/GameStore';
  import type { GameType } from '../../types/Game';

  const select = document.getElementById('gameSelect') as HTMLSelectElement;

  // Set initial game state
  const pathParts = window.location.pathname.split('/');
  const gameId = pathParts[1] as GameType;
  if (gameId) {
    currentGameId.set(gameId);
    // Ensure select value is set
    select.value = gameId;
  }

  // Handle game selection

  select?.addEventListener('change', (e) => {
    const gameId = (e.target as HTMLSelectElement)?.value as GameType;
    currentGameId.set(gameId);
    if (gameId) {
      window.location.href = `/${gameId}`;
    } else {
      window.location.href = '/';
    }
  });
</script>
