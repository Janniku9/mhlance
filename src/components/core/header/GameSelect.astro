---
import { Games } from '../../../data/games';
import { getGameFromPath } from '../../../utils/game';

const currentPath = Astro.url.pathname;
const selectedGame = getGameFromPath(currentPath);

const { class: className } = Astro.props;

const FontStyle = 'text-text text-xl';
const SelectFontStyle = 'text-text-secondary text-xs';
---

<select
  id="gameSelect"
  class=`rounded-lg border-0 bg-background-darker text-text h-full ${className} ${FontStyle}`
>
  <option value="" class={SelectFontStyle}>SELECT GAME</option>
  {
    Games.map((game) => (
      <option value={game.id} selected={selectedGame?.id === game.id} class={SelectFontStyle}>
        {game.name.toUpperCase()}
      </option>
    ))
  }
</select>

<script>
  import { currentGameId } from '../../../stores/GameStore';
  import type { GameType } from '../../../types/Game';

  const select = document.getElementById('gameSelect') as HTMLSelectElement;

  const pathParts = window.location.pathname.split('/');
  const gameId = pathParts[1] as GameType;
  if (gameId) {
    currentGameId.set(gameId);
    // Ensure select value is set
    select.value = gameId;
  }

  // Handle game selection
  select?.addEventListener('change', (e) => {
    const gameId = (e.target as HTMLSelectElement)?.value as GameType;
    currentGameId.set(gameId);
    if (gameId) {
      window.location.href = `/${gameId}`;
    } else {
      window.location.href = '/';
    }
  });
</script>
