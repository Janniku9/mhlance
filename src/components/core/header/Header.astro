---
import { BREAKPOINTS } from '../../../types/Header';
import DesktopNav from '../nav/DesktopNav.astro';
import MobileNav from '../nav/MobileNav.astro';
import MobileMenu from '../nav/MobileMenu.astro';
import HeaderLogo from './HeaderLogo.astro';
import GameSelector from '../nav/GameSelector.astro';
import { games } from '../../../types/Navigation';

interface Props {
  height: string;
}

const { height } = Astro.props;

// Get current game from URL
const currentPath = Astro.url.pathname;
const gameId = currentPath.split('/')[1] || 'world';
const currentGame = games.find((g) => g.game === gameId);
---

<header
  id="header"
  class="fixed top-0 left-0 right-0 z-50 transition-all duration-200"
  style={`height: ${height}`}
>
  <nav class="max-w-7xl mx-auto px-6 h-full flex items-center justify-between">
    <HeaderLogo />

    <!-- Desktop Navigation -->
    <DesktopNav currentGame={currentGame} />

    <!-- Mobile Navigation -->
    <MobileNav>
      <GameSelector games={games} />
    </MobileNav>
  </nav>
</header>

<MobileMenu currentGame={currentGame} />

<script>
  // Header scroll effect
  const header = document.getElementById('header');

  if (header) {
    const updateHeader = () => {
      const scrollProgress = Math.min(window.scrollY / 100, 1);
      const backgroundOpacity = scrollProgress * 0.95;
      const borderOpacity = scrollProgress;

      header.style.backgroundColor = `rgba(30, 24, 28, ${backgroundOpacity})`;
      header.style.boxShadow = `0 1px ${borderOpacity * 4}px rgba(255, 235, 59, ${borderOpacity * 0.3})`;
    };

    updateHeader();
    window.addEventListener('scroll', updateHeader);
  }
</script>
